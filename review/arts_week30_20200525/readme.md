

# 关于列式存储  

## 起源 

2015年，大数据兴起
cassandra 列式存储查询性能提升100倍 
大数据--- 为TB甚至PB级别数据的实时查询和更新都提供了解决方案 

## 列式存储定义

相对于行式存储（关系型数据库）---Oracle Mysql SQLServer 
数据量不大（<千万）
列式数据库--以列相关存储架构进行数据存储的数据库  
大数据明星产品： HBase cassandra 
以列存储--自动索引  

## 列式存储原理
行式存储--基于字段, 磁盘寻址,IO浪费较大
列式存储--基于列，数据紧凑,IO较少 


## 列式存储解决的问题
* 数据库不读取无效数据--提高了系统I/O  
   只查询指定列上的数据  
   只返回指定列上的数据  
   磁盘I/O效率高  
   例如： 100列， 100G数据  
* 数据压缩比--节省磁盘空间  
   每个数据包内都是同构的数据  
   数据相关性大  
   数据压缩比高(1/10升至更高)  
   利用Cache I/O  
   
## 列式存储的遗留问题  
*  如何高效新增   
    Column Family(列族)--可以包含多个列  
    多个列族，并发写磁盘  
    同一个列族内顺序存储Block  
*  如何高效更新  
   新增-- 添加一个新版本号的数据   
   查询-- 默认查询最新版本数据  
   顺序写磁盘，巧妙的解决了海量数据的查询更新和重建索引的过程  
*  如何高效删除  
   删除 -- 添加删除标记 keyType=Delete
   查询 -- keyType=Delete表示数据已经被删除  
   Major_compaction 删除物理数据  
   顺序写磁盘，很容易实现海量数据的快速删除，有效避免了在海量数据库中查找执行删除操作以及重建索引等复杂的流程  
   
   
## 总结  

列式存储 vs 行式存储： 
行式存储----数据按行存储，统计分析方便，海量数据（千万级别）效率慢  
列式存储----数据按列存储，查询展示以列为单位，海量数据查询效率高  

为啥速度快： 
*  列式存储-- 自动化索引，降低I/O册数，提高查询效率
*  多列族存储 -- 提高新增效率
*  标记更新  -- 提高更新效率
*  标记删除  -- 提高删除效率
   


